{% extends "base.html" %}
{% block content %}

<form method="get" class="filters">
  <span class="muted">Filters:</span>
  <a class="linkbtn" href="{% url 'tasks:list' %}">All</a>
  <a class="linkbtn" href="?status=not_started{% if active_list_id %}&list={{ active_list_id }}{% endif %}">Not started</a>
  <a class="linkbtn" href="?status=in_progress{% if active_list_id %}&list={{ active_list_id }}{% endif %}">In progress</a>
  <a class="linkbtn" href="?status=done{% if active_list_id %}&list={{ active_list_id }}{% endif %}">Done</a>

  <select name="list" onchange="this.form.submit()">
    <option value="">All lists</option>
    {% for l in lists %}
      <option value="{{ l.id }}" {% if active_list_id|stringformat:'s' == l.id|stringformat:'s' %}selected{% endif %}>{{ l.name }}</option>
    {% endfor %}
  </select>
</form>

<ul class="list">
  {% for t in object_list %}
    <li class="item">
      <form method="post" action="{% url 'tasks:toggle' t.pk %}">
        {% csrf_token %}
        <button class="toggle" type="submit" aria-label="Toggle done">
          {% if t.status == 'done' %}âœ“{% else %}&nbsp;{% endif %}
        </button>
      </form>

      <div class="item-main">
        <strong class="title {% if t.status == 'done' %}done{% endif %}">{{ t.title }}</strong>
        {% if t.description %}
          <p class="desc">{{ t.description }}</p>
        {% endif %}
        <div class="meta">
          {% if t.due_date %}
            <span class="chip">Due: {{ t.due_date|date:"m/d/Y" }}{% if t.due_time %} {{ t.due_time|time:"H:i" }}{% endif %}</span>
          {% endif %}
          {% if t.priority %}<span class="chip -{{ t.priority }}">{{ t.priority|capfirst }}</span>{% endif %}
          {% if t.task_type %}<span class="chip">{{ t.task_type|capfirst }}</span>{% endif %}
          {% if t.todo_list %}<span class="chip muted">List: {{ t.todo_list.name }}</span>{% endif %}
        </div>
      </div>

      <div class="item-actions">
        <a class="linkbtn" href="{% url 'tasks:update' t.pk %}">edit</a>
        <a class="linkbtn" href="{% url 'tasks:delete' t.pk %}">delete</a>
      </div>
    </li>
  {% empty %}
    <li class="empty">No tasks yet.</li>
  {% endfor %}
</ul>
{% endblock %}
